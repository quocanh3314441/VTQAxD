-- Check game
local currentversion = "Garden Tower Defense-VTQAxD"

-- call the library (executor must allow HttpGet & loadstring)
local Mercury = loadstring(game:HttpGet("https://raw.githubusercontent.com/deeeity/mercury-lib/master/src.lua"))()

-- Main frame
local GUI = Mercury:Create{
    Name = "Mercury",
    Size = UDim2.fromOffset(600, 400),
    Theme = Mercury.Themes.Dark,
    Link = "https://github.com/deeeity/mercury-lib"
}

-- Local var
local autojoinmap = false
local autojoindojo = false
local autodifficulty = false
local autospeedchange = false
local autoskipwaves = false
local autorestart = false
local autowindojo = false

-- Farm tab Creation
local farmTab = GUI:tab{
    Name = "Auto Farm",
    Icon = "rbxassetid://7734068321"
}

farmTab:toggle{
    Name = "auto join map",
    StartingState = false,
    Description = "Automatically joins a map when loaded (only on specific PlaceId)",
    Callback = function(state)
        -- only allow enabling on the intended PlaceId
        if state and game.PlaceId ~= 108533757090220 then
            warn("Auto join map disabled: wrong PlaceId", game.PlaceId)
            return
        end

        autojoinmap = state
        if autojoinmap then
            task.spawn(function()
                while autojoinmap do
                    local char = game.Players.LocalPlayer.Character
                    if char then
                        local pl = char:FindFirstChild("HumanoidRootPart")
                        local humanoid = char:FindFirstChild("Humanoid")
                        if pl and humanoid then
                            local location = CFrame.new(82, 66, 784)
                            humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping, true)
                            pl.CFrame = location
                        end
                    end
                    task.wait(1)
                end
            end)
        end
    end
}

farmTab:toggle{
    Name = "auto join dojo",
    StartingState = false,
    Description = "Automatically joins the dojo when loaded",
    Callback = function(state)
        autojoindojo = state
        if autojoindojo then
            task.spawn(function()
                while autojoindojo do
                    local args = {[1] = "map_dojo"}
                    pcall(function()
                        game:GetService("ReplicatedStorage").RemoteFunctions.LobbySetMap_5:InvokeServer(unpack(args))
                    end)
                    task.wait(1)
                end
            end)
        end
    end
}

farmTab:toggle{
    Name = "auto difficulty",
    StartingState = false,
    Description = "auto sets difficulty to apocalypse",
    Callback = function(state)
        autodifficulty = state
        if autodifficulty then
            task.spawn(function()
                while autodifficulty do
                    local args = {
                        [1] = "dif_apocalypse"
                    }
                    pcall(function()
                        game:GetService("ReplicatedStorage"):WaitForChild("RemoteFunctions"):WaitForChild("PlaceDifficultyVote"):InvokeServer(unpack(args))
                    end)
                    task.wait(1)
                end
            end)
        end
    end
}

farmTab:toggle{
    Name = "auto change speed",
    StartingState = false,
    Description = "Automatically Changes game speed to 2x",
    Callback = function(state)
        autospeedchange = state
        if autospeedchange then
            task.spawn(function()
                while autospeedchange do
                    pcall(function()
                        local args = {[1] = 2}
                        game:GetService("ReplicatedStorage"):WaitForChild("RemoteFunctions"):WaitForChild("ChangeTickSpeed"):InvokeServer(unpack(args))
                    end)
                    task.wait(1)
                end
            end)
        end
    end
}

farmTab:toggle{
    Name = "auto skip waves",
    StartingState = false,
    Description = "Auto skip waves",
    Callback = function(state)
        autoskipwaves = state
        if autoskipwaves then
            task.spawn(function()
                while autoskipwaves do
                    pcall(function()
                        local args = {[1] = "y"}
                        game:GetService("ReplicatedStorage"):WaitForChild("RemoteFunctions"):WaitForChild("SkipWave"):InvokeServer(unpack(args))
                    end)
                    task.wait(1)
                end
            end)
        end
    end
}

farmTab:toggle{
    Name = "auto restart",
    StartingState = false,
    Description = "Auto restart game",
    Callback = function(state)
        autorestart = state
        if autorestart then
            task.spawn(function()
                while autorestart do
                    pcall(function()
                        game:GetService("ReplicatedStorage"):WaitForChild("RemoteFunctions"):WaitForChild("RestartGame"):InvokeServer()
                    end)
                    task.wait(5)
                end
            end)
        end
    end
}

farmTab:toggle{
    Name = "auto win dojo",
    StartingState = false,
    Description = "Auto place Rafflesia (1250 each) and upgrade tower (8000) - cash based",
    Callback = function(state)
        autowindojo = state
        if not autowindojo then return end

        task.spawn(function()
            local Players = game:GetService("Players")
            local pl = Players.LocalPlayer
            if not pl then warn("auto win dojo: LocalPlayer not found"); return end

            -- Find cash object
            local cashObj
            local attempts = 0
            while autowindojo and attempts < 120 do
                local ls = pl:FindFirstChild("leaderstats")
                cashObj = ls and ls:FindFirstChild("Cash")
                if cashObj then break end
                attempts = attempts + 1
                task.wait(0.5)
            end
            if not cashObj then
                warn("auto win dojo: leaderstats->Cash not found on client; aborting")
                return
            end

            local function getCash()
                return tonumber(cashObj.Value) or 0
            end

            local function waitForCash(minCash)
                -- immediate pass if we already have enough
                if getCash() >= minCash then return true end
                -- real-time wait using Changed event
                local fulfilled = false
                local conn
                conn = cashObj.Changed:Connect(function(newVal)
                    if tonumber(newVal) and tonumber(newVal) >= minCash then
                        fulfilled = true
                        if conn and conn.Connected then conn:Disconnect() end
                    end
                end)
                -- wait until cash threshold met or toggle disabled
                while autowindojo and not fulfilled do
                    task.wait(0.1)
                end
                if conn and conn.Connected then conn:Disconnect() end
                return autowindojo and fulfilled
            end

            local remoteRF = game:GetService("ReplicatedStorage"):FindFirstChild("RemoteFunctions")
            if not remoteRF then warn("auto win dojo: RemoteFunctions not found"); return end
            local placeRemote = remoteRF:FindFirstChild("PlaceUnit")
            local upgradeRemote = remoteRF:FindFirstChild("UpgradeUnit")
            if not placeRemote or not upgradeRemote then
                warn("auto win dojo: required remotes missing (PlaceUnit/UpgradeUnit)")
                return
            end

            -- main repeating sequence
            while autowindojo do
                -- Unit 1 on Path 1 (1250 cash)
                if not waitForCash(1250) then break end
                pcall(function()
                    placeRemote:InvokeServer("unit_rafflesia", {
                        Valid = true, PathIndex = 1,
                        Position = Vector3.new(29.287548065185547, -21.749000549316406, -21.569156646728516),
                        DistanceAlongPath = 46.49023048897571,
                        Rotation = 180,
                        CF = CFrame.new(29.287548065185547, -21.749000549316406, -21.569156646728516) * CFrame.Angles(0, -0.3936169147491455, -0)
                    })
                end)
                task.wait(0.5)
                if not autowindojo then break end

                -- Unit 2 on Path 2 (1250 cash)
                if not waitForCash(1250) then break end
                pcall(function()
                    placeRemote:InvokeServer("unit_rafflesia", {
                        Valid = true, PathIndex = 2,
                        Position = Vector3.new(-38.87824630737305, -21.7496395111084, 18.938264846801758),
                        DistanceAlongPath = 88.56003311901512,
                        Rotation = 180,
                        CF = CFrame.new(-38.87824630737305, -21.7496395111084, 18.938264846801758) * CFrame.Angles(0, -0.19589854776859283, -0)
                    })
                end)
                task.wait(0.5)
                if not autowindojo then break end

                -- Unit 3 on Path 1 (1250 cash)
                if not waitForCash(1250) then break end
                pcall(function()
                    placeRemote:InvokeServer("unit_rafflesia", {
                        Valid = true, PathIndex = 1,
                        Position = Vector3.new(43.06715393066406, -21.75, -46.14543151855469),
                        DistanceAlongPath = 17.911519790899195,
                        Rotation = 180,
                        CF = CFrame.new(43.06715393066406, -21.75, -46.14543151855469) * CFrame.Angles(0, -0.7827028632164001, -0)
                    })
                end)
                task.wait(0.5)
                if not autowindojo then break end

                -- Upgrade tower 194 (8000 cash)
                if not waitForCash(8000) then break end
                pcall(function()
                    upgradeRemote:InvokeServer(194)
                end)
                task.wait(1)
            end

            print("Auto win dojo stopped/cleaned up (real-time)")
        end)
    end
}

print("GTD script loaded successfully")
